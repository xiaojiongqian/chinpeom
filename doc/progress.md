# 唐诗译境（Chinpoem）项目进度与实施规划

## 项目概述

唐诗译境是一个面向国际用户的唐诗学习游戏应用，通过猜测被翻译的诗句来增强用户对唐诗的理解和记忆。

**国际化定位**：面向海外用户，提供6种界面语言（中文、英语、西班牙语、日语、法语、德语）。

**开发方法**：采用测试驱动开发（TDD），以纯本地/终端方案为核心，静态资源+本地JSON持久化确保离线可用。

## 当前状态

### ✅ 已完成核心功能（当前）
- **游戏系统**：诗歌展示、选项生成、答题反馈、得分计算
- **账户与进度**：终端本地账户、积分记录、等级称号、本地JSON持久化
- **界面系统**：引导页（无登录）、游戏、设置、成就
- **音乐系统**：背景音乐轮播、智能播放策略
- **成就系统**：11级古代学级称号、进度展示

### ▶ 下一步聚焦
根据最新PRD要求，需要实施以下工作：
- 完善中文模式逻辑，确保简单/困难模式表现符合预期
- 完成终端账户工具 `poemctl` 与前端读写集成
- 完善本地日志导出与错误诊断

## 技术栈概览

- **前端**：Vue 3 + TypeScript + Vite + TailwindCSS
- **状态管理**：Pinia + Vue Router + Vue I18n
- **测试**：Vitest + Vue Test Utils
- **移动端**：Capacitor (iOS/Android)
- **存储**：Capacitor Filesystem + localStorage（运行时缓存，持久化至本地JSON）

## 功能状态一览

### 1. 核心游戏功能 ✅ 完成
- ✅ 随机诗歌展示和配图
- ✅ 智能选项生成（4选1，3个干扰项）
- ✅ 双难度模式（简单：外语提示，困难：星号占位）
- ✅ 得分系统（简单±1分，困难±2分）
- ✅ 答题反馈和视觉提示

### 2. 账户与进度 ✅ 完成 | ▶ 持续优化
   - ✅ 终端本地账户（create/list/switch）
   - ✅ 11级古代学级称号系统（白丁到状元）
   - ✅ 本地JSON持久化与读写策略
   - ▶ CLI导入/导出与备份策略

### 3. 界面系统 ✅ 完成 | ⚠️ 需调整
- ✅ 四个主要页面：引导、游戏、设置、成就
- ✅ 底部三栏导航
- ✅ 响应式设计
- ⚠️ 需要：分离界面语言与诗歌提示语言设置

### 4. 音乐系统 ✅ 完成
   - ✅ 8首背景音乐自动轮播
- ✅ 智能音效控制
- ✅ 暂停/恢复播放功能

### 5. 成就系统 ✅ 完成
- ✅ 分数展示和进度条
- ✅ 等级称号说明

### 6. 本地可观测性 ▶ 进行中
- ▶ 本地运行日志（账户切换、积分变动、配置保存）
- ▶ 导出日志功能

### 7. 诗歌详情与AI对话 ▶ 可选
- ▶ 诗歌详情页
- ▶ LLM服务集成与对话功能（可选，前端直连）

## 开发阶段回顾

### 第一阶段：基础架构（已完成）✅
**时间**：1周 | **状态**：100%完成
- [x] 项目环境搭建和依赖配置
- [x] 基础UI组件库开发
- [x] 数据模型设计和测试框架

### 第二阶段：核心功能（已完成）✅
**时间**：2周 | **状态**：100%完成
- [x] 诗歌数据处理和展示
- [x] 答题功能和选项生成
- [x] 用户系统和状态管理
- [x] 音乐系统和界面优化

### 第三阶段：优化完善（已完成）✅
**时间**：1周 | **状态**：100%完成
- [x] 用户体验优化
- [x] 成就系统完善
- [x] 测试覆盖率提升

### 第四阶段：终端账户与本地持久化（当前阶段）
**时间**：1周 | **状态**：进行中
- [ ] poemctl CLI 实现与文档
- [ ] 前端读写与节流写盘策略
- [ ] 本地日志与导出

### 第五阶段：诗歌详情与AI对话功能开发（规划中）
**时间**：1.5周 | **状态**：规划中

#### Sprint 1：诗歌详情页面开发（3天）
**目标**：创建诗歌详情页面，加载并展示结构化数据
- [ ] **任务1.1**：创建`PoemDetailView.vue`页面及路由，实现从主页点击诗歌跳转
- [ ] **任务1.2**：开发`PoemDetailDialog.vue`组件，负责读取并渲染`poem_stories_*.json`中的解释、典故、背景等信息
- [ ] **任务1.3**：完善UI布局，确保内容可滚动，并适配多语言显示

#### Sprint 2：LLM对话功能集成（3天）
**目标**：集成LLM服务，实现AI对话功能
- [ ] **任务2.1**：开发`llmApi.ts`服务，封装对DeepSeek API的调用逻辑
- [ ] **任务2.2**：实现底部对话框UI，包括用户输入、发送按钮和聊天记录展示
- [ ] **任务2.3**：实现预设的3个动态问题按钮，点击可将问题填入输入框

#### Sprint 3：测试与优化（2天）
**目标**：确保新功能稳定且体验良好
- [ ] **任务3.1**：为新开发的组件和服务编写单元测试与组件测试
- [ ] **任务3.2**：进行端到端的功能测试，优化交互体验和性能

## 交付标准

### 功能完整性
- [x] 所有PRD核心功能已实现
- [ ] 终端账户切换与持久化策略稳定
- [ ] 多语言架构运行稳定

### 代码质量
- [x] 测试覆盖率47.75%（目标80%+）
- [ ] 国际化功能测试覆盖完整
- [x] TypeScript类型安全
- [x] 代码规范一致性

### 用户体验
- [x] 界面美观现代化
- [ ] 多语言界面适配良好
- [ ] 首次启动引导清晰
- [ ] 跨平台文件权限和路径兼容良好

## 风险管理

| 风险项 | 可能性 | 影响 | 缓解策略 | 状态 |
|--------|--------|------|----------|------|
| 文件权限差异（Windows/macOS/Linux） | 中 | 中 | 统一封装文件I/O，提供失败回退与提示 | 监控中 |
| 语言架构重构影响现有功能 | 低 | 高 | 充分测试，分阶段实施 | 可控 |
 
| 用户数据迁移风险 | 低 | 高 | 保持向后兼容，渐进式迁移 | 可控 |

## 下一步工作重点

### 立即开始（本周）
1. **poemctl CLI**：实现create/list/switch/import/export并完善帮助信息
2. **语言架构优化**：完善中文模式与难度逻辑
3. **本地日志方案**：确定格式、滚动与导出策略

### 近期完成（2周内）
1. **终端账户与本地持久化完善**
2. **多语言测试**：确保6种语言的完整性和准确性
3. **移动端文件权限与路径兼容性验证**

### 后续优化（可选）
1. **性能优化**：提升应用加载速度和运行流畅度
2. **测试覆盖率提升**：达到80%以上覆盖率
3. **移动端打包与分发**：Capacitor iOS/Android 发布

---

**总结**：唐诗译境项目核心玩法稳定，已切换为纯本地/终端实现，正在完善账户与本地持久化与日志功能。

## 历史服务器实现（存档）
涉及第三方登录、Firebase Analytics、Express API、数据库与付费逻辑等内容已迁移至分支 `v1.0-with-backend-server`。
需要回顾历史路线与工作项时，请切换至该分支。
