# 唐诗译境（Chinpoem）项目进度与实施规划

## 项目概述

唐诗译境是一个面向国际用户的唐诗学习游戏应用，通过猜测被翻译的诗句来增强用户对唐诗的理解和记忆。

**国际化定位**：专为海外用户设计，支持Apple、Google、Twitter/X登录，提供5种外语界面（英语、西班牙语、日语、法语、德语）。

**开发方法**：采用测试驱动开发（TDD），优先实现纯前端功能，本地存储模式确保离线可用。

## 当前状态

### ✅ 已完成核心功能（100%）
- **游戏系统**：诗歌展示、选项生成、答题反馈、得分计算
- **用户系统**：第三方登录、积分记录、等级称号、数据持久化
- **界面系统**：登录、游戏、设置、成就四个主要页面
- **音乐系统**：背景音乐轮播、音效控制、智能播放策略
- **成就系统**：11级古代学级称号、进度展示、付费解锁

### ⚠️ 需要整合和重构
根据最新PRD要求，需要实施以下重构：
- 移除微信登录，调整为Apple + Google + Twitter/X
- 完善中文模式逻辑，确保简单/困难模式表现符合预期
- 集成Firebase Analytics用户行为分析
- 调整付费限制（免费用户最高25分）
- 实现SSO单点登录功能

## 技术栈概览

- **前端**：Vue 3 + TypeScript + Vite + TailwindCSS
- **状态管理**：Pinia + Vue Router + Vue I18n
- **认证**：Firebase Authentication (Apple/Google/Twitter)
- **分析**：Firebase Analytics (用户行为追踪)
- **测试**：Vitest + Vue Test Utils (覆盖率47.75%)
- **移动端**：Capacitor (iOS/Android)
- **存储**：localStorage (本地存储模式)

## 功能状态一览

### 1. 核心游戏功能 ✅ 完成
- ✅ 随机诗歌展示和配图
- ✅ 智能选项生成（4选1，3个干扰项）
- ✅ 双难度模式（简单：外语提示，困难：星号占位）
- ✅ 得分系统（简单±1分，困难±2分）
- ✅ 答题反馈和视觉提示

### 2. 用户系统 ✅ 完成 | ⚠️ 需调整
   - ✅ 第三方账号登录（微信、Google、苹果）
- ✅ 用户积分本地存储+服务器同步
- ✅ 11级古代学级称号系统（白丁到状元）
- ⚠️ 需要：移除微信登录，添加Twitter/X
- ⚠️ 需要：实现SSO单点登录检测

### 3. 界面系统 ✅ 完成 | ⚠️ 需调整
- ✅ 四个主要页面：登录、游戏、设置、成就
- ✅ 底部三栏导航
- ✅ 响应式设计
- ⚠️ 需要：分离界面语言与诗歌提示语言设置

### 4. 音乐系统 ✅ 完成
   - ✅ 8首背景音乐自动轮播
- ✅ 智能音效控制
- ✅ 暂停/恢复播放功能

### 5. 成就系统 ✅ 完成 | ⚠️ 需调整
- ✅ 分数展示和进度条
- ✅ 等级称号说明
- ✅ 付费解锁逻辑
- ⚠️ 需要：调整免费用户限制至25分

### 6. 数据分析 ❌ 待实现
- ❌ Firebase Analytics集成
- ❌ 用户行为埋点
- ❌ 关键动作追踪

### 7. 诗歌详情与AI对话 ❌ 待实现
- ❌ 诗歌详情页
- ❌ LLM服务集成与对话功能

## 开发阶段回顾

### 第一阶段：基础架构（已完成）✅
**时间**：1周 | **状态**：100%完成
- [x] 项目环境搭建和依赖配置
- [x] 基础UI组件库开发
- [x] 数据模型设计和测试框架

### 第二阶段：核心功能（已完成）✅
**时间**：2周 | **状态**：100%完成
- [x] 诗歌数据处理和展示
- [x] 答题功能和选项生成
- [x] 用户系统和状态管理
- [x] 音乐系统和界面优化

### 第三阶段：优化完善（已完成）✅
**时间**：1周 | **状态**：100%完成
- [x] 用户体验优化
- [x] 成就系统完善
- [x] 测试覆盖率提升

### 第四阶段：国际化重构（当前阶段）⚠️
**时间**：2周 | **状态**：规划中
- [ ] 登录方式调整（移除微信，添加Twitter/X）
- [ ] 语言架构重构（分离界面和诗歌提示语言）
- [ ] Firebase Analytics集成
- [ ] SSO单点登录实现
- [ ] 付费限制调整

### 第五阶段：诗歌详情与AI对话功能开发（规划中）
**时间**：1.5周 | **状态**：规划中

#### Sprint 1：诗歌详情页面开发（3天）
**目标**：创建诗歌详情页面，加载并展示结构化数据
- [ ] **任务1.1**：创建`PoemDetailView.vue`页面及路由，实现从主页点击诗歌跳转
- [ ] **任务1.2**：开发`PoemDetailDialog.vue`组件，负责读取并渲染`poem_stories_*.json`中的解释、典故、背景等信息
- [ ] **任务1.3**：完善UI布局，确保内容可滚动，并适配多语言显示

#### Sprint 2：LLM对话功能集成（3天）
**目标**：集成LLM服务，实现AI对话功能
- [ ] **任务2.1**：开发`llmApi.ts`服务，封装对DeepSeek API的调用逻辑
- [ ] **任务2.2**：实现底部对话框UI，包括用户输入、发送按钮和聊天记录展示
- [ ] **任务2.3**：实现预设的3个动态问题按钮，点击可将问题填入输入框

#### Sprint 3：测试与优化（2天）
**目标**：确保新功能稳定且体验良好
- [ ] **任务3.1**：为新开发的组件和服务编写单元测试与组件测试
- [ ] **任务3.2**：进行端到端的功能测试，优化交互体验和性能

## 交付标准

### 功能完整性
- [x] 所有PRD核心功能已实现
- [ ] 国际化重构需求全部完成
- [ ] SSO单点登录体验流畅
- [ ] 多语言架构运行稳定

### 代码质量
- [x] 测试覆盖率47.75%（目标80%+）
- [ ] 国际化功能测试覆盖完整
- [x] TypeScript类型安全
- [x] 代码规范一致性

### 用户体验
- [x] 界面美观现代化
- [ ] 多语言界面适配良好
- [ ] 登录流程简化友好
- [ ] 付费体验合理引导

## 风险管理

| 风险项 | 可能性 | 影响 | 缓解策略 | 状态 |
|--------|--------|------|----------|------|
| Twitter API集成复杂性 | 中 | 中 | 预先调研API文档，准备备选方案 | 监控中 |
| 语言架构重构影响现有功能 | 低 | 高 | 充分测试，分阶段实施 | 可控 |
| Firebase Analytics配置错误 | 低 | 中 | 详细文档和测试验证 | 可控 |
| 用户数据迁移风险 | 低 | 高 | 保持向后兼容，渐进式迁移 | 可控 |

## 下一步工作重点

### 立即开始（本周）
1. **Twitter/X登录集成调研**：申请开发者账号，研究API集成方案
2. **语言架构设计**：详细设计分离后的数据结构和UI交互
3. **Firebase Analytics规划**：确定埋点事件和数据收集策略

### 近期完成（2周内）
1. **国际化重构实施**：按照Sprint计划逐步完成重构
2. **SSO功能实现**：提升用户登录体验
3. **多语言测试**：确保5种语言的完整性和准确性

### 后续优化（可选）
1. **性能优化**：提升应用加载速度和运行流畅度
2. **测试覆盖率提升**：达到80%以上覆盖率
3. **生产环境部署**：真实API集成和支付系统

---

**总结**：唐诗译境项目核心功能已100%完成，正在进行国际化重构以适应海外市场需求。预计2周内完成重构，届时将拥有完整的国际化多语言学习平台。 