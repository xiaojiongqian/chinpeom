# 唐诗译境（Chinpoem）项目进度与实施规划

## 项目概述

唐诗译境是一个面向国际用户的唐诗学习游戏应用，通过猜测被翻译的诗句来增强用户对唐诗的理解和记忆。

**国际化定位**：专为海外用户设计，支持Apple、Google、Twitter/X登录，提供5种外语界面（英语、西班牙语、日语、法语、德语）。

**开发方法**：采用测试驱动开发（TDD），优先实现纯前端功能，本地存储模式确保离线可用。

## 当前状态

### ✅ 已完成核心功能（100%）
- **游戏系统**：诗歌展示、选项生成、答题反馈、得分计算
- **用户系统**：第三方登录、积分记录、等级称号、数据持久化
- **界面系统**：登录、游戏、设置、成就四个主要页面
- **音乐系统**：背景音乐轮播、音效控制、智能播放策略
- **成就系统**：11级古代学级称号、进度展示、付费解锁

### ⚠️ 需要国际化重构
根据最新PRD要求，需要实施以下重构：
- 移除微信登录，调整为Apple + Google + Twitter/X
- 移除中文界面支持，仅保留5种外语
- 分离界面语言和诗歌提示语言设置
- 集成Firebase Analytics用户行为分析
- 调整付费限制（免费用户最高25分）
- 实现SSO单点登录功能

## 技术栈概览

- **前端**：Vue 3 + TypeScript + Vite + TailwindCSS
- **状态管理**：Pinia + Vue Router + Vue I18n
- **认证**：Firebase Authentication (Apple/Google/Twitter)
- **分析**：Firebase Analytics (用户行为追踪)
- **测试**：Vitest + Vue Test Utils (覆盖率47.75%)
- **移动端**：Capacitor (iOS/Android)
- **存储**：localStorage (本地存储模式)

## 功能状态一览

### 1. 核心游戏功能 ✅ 完成
- ✅ 随机诗歌展示和配图
- ✅ 智能选项生成（4选1，3个干扰项）
- ✅ 双难度模式（简单：外语提示，困难：星号占位）
- ✅ 得分系统（简单±1分，困难±2分）
- ✅ 答题反馈和视觉提示

### 2. 用户系统 ✅ 完成 | ⚠️ 需调整
   - ✅ 第三方账号登录（微信、Google、苹果）
- ✅ 用户积分本地存储+服务器同步
- ✅ 11级古代学级称号系统（白丁到状元）
- ⚠️ 需要：移除微信登录，添加Twitter/X
- ⚠️ 需要：实现SSO单点登录检测

### 3. 界面系统 ✅ 完成 | ⚠️ 需调整
- ✅ 四个主要页面：登录、游戏、设置、成就
- ✅ 底部三栏导航
- ✅ 响应式设计
- ⚠️ 需要：移除中文界面支持
- ⚠️ 需要：分离界面语言与诗歌提示语言设置

### 4. 音乐系统 ✅ 完成
   - ✅ 8首背景音乐自动轮播
- ✅ 智能音效控制
- ✅ 暂停/恢复播放功能

### 5. 成就系统 ✅ 完成 | ⚠️ 需调整
- ✅ 分数展示和进度条
- ✅ 等级称号说明
- ✅ 付费解锁逻辑
- ⚠️ 需要：调整免费用户限制至25分

### 6. 数据分析 ❌ 待实现
- ❌ Firebase Analytics集成
- ❌ 用户行为埋点
- ❌ 关键动作追踪

## 开发阶段回顾

### 第一阶段：基础架构（已完成）✅
**时间**：1周 | **状态**：100%完成
- [x] 项目环境搭建和依赖配置
- [x] 基础UI组件库开发
- [x] 数据模型设计和测试框架

### 第二阶段：核心功能（已完成）✅
**时间**：2周 | **状态**：100%完成
- [x] 诗歌数据处理和展示
- [x] 答题功能和选项生成
- [x] 用户系统和状态管理
- [x] 音乐系统和界面优化

### 第三阶段：优化完善（已完成）✅
**时间**：1周 | **状态**：100%完成
- [x] 用户体验优化
- [x] 成就系统完善
- [x] 测试覆盖率提升

### 第四阶段：国际化重构（当前阶段）⚠️
**时间**：2周 | **状态**：规划中
- [ ] 登录方式调整（移除微信，添加Twitter/X）
- [ ] 语言架构重构（分离界面和诗歌提示语言）
- [ ] Firebase Analytics集成
- [ ] SSO单点登录实现
- [ ] 付费限制调整

## 第四阶段：国际化重构实施计划

### Sprint 1：登录系统重构（4天）
**目标**：调整登录方式，实现SSO功能

#### 任务1.1：移除微信登录（1天）
- [ ] 移除微信SDK相关代码
- [ ] 清理微信登录按钮和逻辑
- [ ] 更新Firebase Authentication配置
- [ ] 更新测试用例

#### 任务1.2：集成Twitter/X登录（2天）
- [ ] 申请Twitter Developer账号
- [ ] 配置Twitter OAuth应用
- [ ] 集成Twitter SDK到Firebase
- [ ] 实现Twitter登录组件
- [ ] 编写Twitter登录测试

#### 任务1.3：实现SSO单点登录（1天）
- [ ] 实现浏览器登录状态检测
- [ ] 添加"继续使用 [账号]" 快捷登录
- [ ] 实现静默认证逻辑
- [ ] 优化登录界面用户体验

### Sprint 2：多语言架构重构（3天）
**目标**：分离界面语言和诗歌提示语言

#### 任务2.1：移除中文支持（1天）
- [ ] 删除所有中文翻译文件
- [ ] 移除中文语言选项
- [ ] 更新默认语言检测逻辑
- [ ] 验证所有界面无中文残留

#### 任务2.2：语言架构分离（2天）
- [ ] 重构用户数据模型（添加interface_language和poem_hint_language字段）
- [ ] 更新设置页面UI（两个独立语言选择器）
- [ ] 实现困难模式语言逻辑（界面语言保持，诗歌提示显示星号）
- [ ] 自动检测设备语言设置默认值
- [ ] 编写语言分离功能测试

### Sprint 3：Firebase Analytics集成（2天）
**目标**：实现用户行为分析和数据收集

#### 任务3.1：Analytics SDK配置（1天）
- [ ] 安装Firebase Analytics SDK
- [ ] 创建analytics.ts配置文件
- [ ] 配置Analytics权限和隐私合规
- [ ] 设置开发和生产环境配置

#### 任务3.2：关键埋点实现（1天）
- [ ] 用户登录埋点（区分登录平台）
- [ ] 答题行为埋点（正确率、难度）
- [ ] 语言切换埋点（界面/诗歌提示）
- [ ] 付费转化埋点
- [ ] 验证数据收集正确性

### Sprint 4：付费系统调整（1天）
**目标**：调整免费用户限制和付费体验

#### 任务4.1：付费限制调整（1天）
- [ ] 更新FREE_USER_MAX_SCORE为25分
- [ ] 调整数据库秀才等级为付费等级
- [ ] 更新成就界面付费提示文案
- [ ] 测试付费升级流程完整性

### Sprint 5：测试与优化（4天）
**目标**：确保重构质量和用户体验

#### 任务5.1：功能测试（2天）
- [ ] 多平台登录功能测试
- [ ] SSO单点登录流程测试
- [ ] 语言分离设置完整测试
- [ ] Firebase Analytics数据验证
- [ ] 付费流程端到端测试

#### 任务5.2：国际化测试（1天）
- [ ] 5种语言界面完整性测试
- [ ] 翻译准确性和文化适配验证
- [ ] 不同语言下的用户体验测试
- [ ] 自动语言检测功能测试

#### 任务5.3：用户体验优化（1天）
- [ ] 登录流程用户体验优化
- [ ] 语言切换交互体验改进
- [ ] 错误提示多语言完善
- [ ] 界面布局在不同语言下的适配

## 交付标准

### 功能完整性
- [x] 所有PRD核心功能已实现
- [ ] 国际化重构需求全部完成
- [ ] SSO单点登录体验流畅
- [ ] 多语言架构运行稳定

### 代码质量
- [x] 测试覆盖率47.75%（目标80%+）
- [ ] 国际化功能测试覆盖完整
- [x] TypeScript类型安全
- [x] 代码规范一致性

### 用户体验
- [x] 界面美观现代化
- [ ] 多语言界面适配良好
- [ ] 登录流程简化友好
- [ ] 付费体验合理引导

## 风险管理

| 风险项 | 可能性 | 影响 | 缓解策略 | 状态 |
|--------|--------|------|----------|------|
| Twitter API集成复杂性 | 中 | 中 | 预先调研API文档，准备备选方案 | 监控中 |
| 语言架构重构影响现有功能 | 低 | 高 | 充分测试，分阶段实施 | 可控 |
| Firebase Analytics配置错误 | 低 | 中 | 详细文档和测试验证 | 可控 |
| 用户数据迁移风险 | 低 | 高 | 保持向后兼容，渐进式迁移 | 可控 |

## 下一步工作重点

### 立即开始（本周）
1. **Twitter/X登录集成调研**：申请开发者账号，研究API集成方案
2. **语言架构设计**：详细设计分离后的数据结构和UI交互
3. **Firebase Analytics规划**：确定埋点事件和数据收集策略

### 近期完成（2周内）
1. **国际化重构实施**：按照Sprint计划逐步完成重构
2. **SSO功能实现**：提升用户登录体验
3. **多语言测试**：确保5种语言的完整性和准确性

### 后续优化（可选）
1. **性能优化**：提升应用加载速度和运行流畅度
2. **测试覆盖率提升**：达到80%以上覆盖率
3. **生产环境部署**：真实API集成和支付系统

---

**总结**：唐诗译境项目核心功能已100%完成，正在进行国际化重构以适应海外市场需求。预计2周内完成重构，届时将拥有完整的国际化多语言学习平台。 