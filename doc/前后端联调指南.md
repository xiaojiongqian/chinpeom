# 前后端联调测试指南

## 联调测试概述

前后端联调测试是指在实际环境中测试前端和后端系统之间的交互，确保两者能够正确协同工作。与单元测试不同，联调测试关注的是系统整体功能和集成点。

## 系统架构回顾

根据PRD要求，本系统采用混合存储模式：
- **核心诗歌数据**作为静态资源打包在应用中，确保离线状态下可使用主要功能
- **用户账户、排行榜**等社交功能通过远程API实现

## 前提条件

1. **开发环境设置**
   - Node.js 环境已安装
   - 项目依赖已安装（前端和后端）
   - 数据库已配置（存储用户数据）

2. **前端准备**
   - 确保前端API调用未被模拟实现替代
   - 确认API基础URL配置正确指向后端服务
   - 清理任何测试专用的模拟数据和函数
   - 验证静态诗歌数据资源已正确加载

3. **后端准备**
   - 后端服务正常运行
   - 用户相关API端点已实现并可访问
   - 数据库已正确初始化（用户表）

## 联调测试步骤

### 1. 启动开发环境

使用项目中的`dev:full`命令启动完整的开发环境，该命令会同时启动前端和后端服务：

```bash
npm run dev:full
```

这个命令会使用`concurrently`同时运行两个服务：
- 前端开发服务器（Vite）：`npm run dev`
- 后端开发服务器（带有热重载）：`npm run server:dev`

### 2. 关闭测试模式

确保环境变量中**未设置**`NODE_ENV=test`，这样系统不会使用测试模式下的模拟实现。

### 3. 配置前端API地址

前端需要正确配置API地址，确保请求能够到达后端服务。在开发环境中，可以：

1. 检查`.env`或`.env.development`文件中的`VITE_API_BASE_URL`配置
2. 默认值应该是`/api`或`http://localhost:3000/api`（根据实际后端端口调整）

### 4. 验证API连接和静态资源

#### 4.1 API连接验证
在浏览器控制台中检查网络请求：
- 确认用户相关API请求URL正确
- 检查状态码和响应内容
- 如果有跨域问题，确认CORS配置正确

#### 4.2 静态资源验证
确认诗歌数据正确加载：
- 验证`public/resource/data/`目录下的JSON文件（不同语言诗歌数据）能够正确加载
- 验证`public/resource/poem_images/`目录下的诗歌配图能够正确显示
- 检查控制台是否有相关资源加载错误

### 5. 进行功能测试

按照以下步骤进行功能测试：

1. **用户认证功能**（需要后端API）
   - 注册新用户
   - 登录
   - 查看用户信息
   - 登出

2. **诗歌相关功能**（使用静态资源，离线可用）
   - 加载诗歌列表
   - 显示诗歌详情和配图
   - 测试翻译功能
   - 测试猜诗游戏

3. **分数和排行榜**（需要后端API）
   - 完成游戏后更新分数
   - 查看排行榜

### 6. 调试常见问题

1. **API请求失败**（仅影响用户相关功能）
   - 检查网络请求（状态码、请求/响应内容）
   - 验证后端服务是否正常运行
   - 检查API路径是否正确

2. **认证问题**（仅影响用户相关功能）
   - 验证令牌是否正确保存在localStorage中
   - 确认令牌在请求头中正确传递
   - 验证后端正确验证令牌

3. **数据加载问题**
   - **静态资源**：检查资源文件路径是否正确，文件是否存在
   - **API数据**：检查数据格式是否一致，确认必要的数据转换正确实现

## 特殊场景测试

### 1. 离线模式测试

测试应用在网络连接不可用时的行为：
1. 在Chrome开发者工具中使用网络断开功能
2. 验证核心诗歌功能是否仍然可用（静态资源加载）
3. 验证用户相关功能是否适当降级（显示离线提示）

### 2. 性能测试

1. 载入大量诗歌数据时检查应用性能
2. 检查API响应时间（用户相关功能）
3. 验证用户界面在数据加载过程中的反馈

### 3. 错误处理

1. 测试无效输入的提交
2. 测试服务器错误的处理（仅用户相关API）
3. 验证用户友好的错误消息显示

## 生产环境测试

在部署到生产环境之前进行最终测试：

```bash
npm run build:full
```

此命令会构建前端应用并启动生产环境的后端服务。

## 注意事项

1. 保持前后端API契约一致性，任何变更都需要同步更新
2. 定期进行联调测试，特别是在API变更后
3. 确保两种部署模式都经过测试：
   - Web版本：前端静态资源与后端API部署在同一服务器
   - 移动应用版本：前端打包进应用，通过网络请求连接远程API服务器
4. 记住核心诗歌功能应该在离线状态下可用，只有用户相关功能依赖后端API 